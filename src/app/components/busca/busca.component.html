<div class="container-busca">
    
  <!-- Caixa de Pesquisa -->
  <div class="container-pesquisa row">
    <div class="container col-lg-6 col-lg-offset-3">
      
      <div class="scroller scroller-left"><i class="glyphicon glyphicon-chevron-left"></i></div>
      <div class="scroller scroller-right"><i class="glyphicon glyphicon-chevron-right"></i></div>
      <div class="text-center abas-pesquisa">
        <ul class="nav nav-pills aba">
          <li role="presentation" [ngClass]="{'active': pesquisaPor === 'projetos'}"><a (click)="onTrocaPesquisaPor('projetos')">Projetos</a></li>
          <li role="presentation" [ngClass]="{'active': pesquisaPor === 'propostas'}"><a (click)="onTrocaPesquisaPor('propostas')">Propostas</a></li>
          <li role="presentation" [ngClass]="{'active': pesquisaPor === 'proponentes'}"><a (click)="onTrocaPesquisaPor('proponentes')">Proponentes</a></li>
          <li role="presentation" [ngClass]="{'active': pesquisaPor === 'incentivadores'}"><a (click)="onTrocaPesquisaPor('incentivadores')">Incentivadores</a></li>
          <li role="presentation" [ngClass]="{'active': pesquisaPor === 'fornecedores'}"><a (click)="onTrocaPesquisaPor('fornecedores')">Fornecedores</a></li>
        </ul>
      </div>

      <div class="linha"></div>
      <div class="container-inputs">
        
        <!-- Busca Simples ============================================================== -->
        <div *ngIf="!buscaAvancada" class="row input-group" [ngSwitch]="pesquisaPor">
          <input *ngSwitchCase="'projetos'" type="text" [(ngModel)]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" placeholder="Pesquisar por {{ pesquisaPor }}">
          <input *ngSwitchCase="'propostas'" type="text" [(ngModel)]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" placeholder="Pesquisar por {{ pesquisaPor }}">
          <input *ngSwitchCase="'proponentes'" type="text" [(ngModel)]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" placeholder="Pesquisar por {{ pesquisaPor }}">
          <input *ngSwitchCase="'incentivadores'" type="text" [(ngModel)]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" placeholder="Pesquisar por {{ pesquisaPor }}">
          <input *ngSwitchCase="'fornecedores'" type="text" [(ngModel)]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" placeholder="Pesquisar por {{ pesquisaPor }}">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="submit" (click)="onRealizarBusca()">BUSCAR</button>
          </span>
        </div>

        <!-- Busca Avançada ============================================================ -->
        <div *ngIf="buscaAvancada" class="form-group">
          <div class="row">
            <div class="input col-sm-4">
              <input type="text" [ngModel]="queries['nome']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['nome'] !== undefined && queries['nome'] !== null && queries['nome'] !== ''}">
              <div class="form-control-placeholder">Nome do projeto</div>
            </div>
            <div class="input col-sm-2 col-xs-6">
              <input type="text" [(ngModel)]="queries['PRONAC']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['PRONAC'] !== undefined && queries['PRONAC'] !== null && queries['PRONAC'] !== ''}">
              <div class="form-control-placeholder">PRONAC</div>
            </div>
            <div class="input col-sm-2 col-xs-6">
              <input type="text" [(ngModel)]="queries['area']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['area'] !== undefined && queries['area'] !== null && queries['area'] !== ''}">
              <div class="form-control-placeholder">Área</div>
            </div>
            <div class="input col-sm-2 col-xs-6">
              <input type="text" [(ngModel)]="queries['segmento']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['segmento'] !== undefined && queries['segmento'] !== null && queries['segmento'] !== ''}">
              <div class="form-control-placeholder">Segmento</div>
            </div>
            <div class="input col-sm-2 col-xs-6">
              <input type="text" [(ngModel)]="queries['municipio']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['municipio'] !== undefined && queries['municipio'] !== null && queries['municipio'] !== ''}">
              <div class="form-control-placeholder">Município</div>
            </div>
          </div>
          <div class="row">
            <div class="input col-sm-3">
              <input type="text" [(ngModel)]="queries['proponente']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['proponente'] !== undefined && queries['proponente'] !== null && queries['proponente'] !== ''}">
              <div class="form-control-placeholder">Nome do Proponente</div>
            </div>
            <div class="input col-sm-3">
              <input type="text" [(ngModel)]="queries['cgccpf']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['cgccpf'] !== undefined && queries['cgccpf'] !== null && queries['cgccpf'] !== ''}">
              <div class="form-control-placeholder">CPF/CNPJ</div>
            </div>
            <div class="input col-sm-3 col-xs-6">
              <input type="text" [(ngModel)]="queries['data_inicio']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['data_inicio'] !== undefined && queries['data_inicio'] !== null && queries['data_inicio'] !== ''}">
              <div class="form-control-placeholder">Data de Início</div>
            </div>
            <div class="input col-sm-3 col-xs-6">
              <input type="text" [(ngModel)]="queries['data_termino']" (keypress)="onRealizarBuscaComEnter($event)" class="form-control" [ngClass]="{'cheio': queries['data_termino'] !== undefined && queries['data_termino'] !== null && queries['data_termino'] !== ''}">
              <div class="form-control-placeholder">Data de Término</div>
            </div>
          </div>
        </div>

        <!-- Footer da Busca ============================================================== -->   
          <div class="row footer-busca">
            <div class="col-lg-12">
            <a (click)="buscaAvancada = !buscaAvancada">{{ buscaAvancada ? 'Busca Simples' : 'Busca Avançada' }}</a>
            <button *ngIf="buscaAvancada" class="btn btn-primary pull-right" type="submit" (click)="onRealizarBusca()">BUSCAR</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-header-resultados">
    <div *ngIf="passouDoScrollTop() && !buscaSemResultados && !carregandoDados">
      <div class="header-respostas fixo">
        <h3>Resultado </h3>
        <div class="chip-wrapper" *ngFor="let key of keys(queries)">
          <div class="chip" *ngIf="queries[key] != null && queries[key] != '' && queries[key] != undefined" >
            <!--<div class="chip-tag">{{key}}</div>-->
              {{queries[key]}}
            <span class="glyphicon glyphicon-remove" aria-hidden="true" (click)='removeQuery(key)'></span>
          </div>
        </div>
        <!--<div class="linha"> </div>-->
      </div>
    </div>
    
    <div id="headerRespostas" class="header-respostas" *ngIf="keys(ordenarPorQueries).length > 0" >
        <h3>Resultado </h3>
        <div class="chip-wrapper" *ngFor="let key of keys(queries)">
          <div class="chip" *ngIf="queries[key] != null && queries[key] != '' && queries[key] != undefined" >
            <!--<div class="chip-tag">{{key}}</div>-->
              {{queries[key]}}
            <span class="glyphicon glyphicon-remove" aria-hidden="true" (click)='removeQuery(key)'></span>
          </div>
        </div>
        <div class="linha"> </div>
    </div>
  </div>

  <!-- ORDENAÇÃO E PAGINACAO, QUANDO DISPONÍVEL =================================================================================-->  
  <div class="col-lg-8 col-md-12 col-lg-offset-2 container-ordenacao" [ngStyle]="{'display': !buscaSemResultados && !carregandoDados? 'block' : 'none' }">
    <div class="row">     
      <div *ngIf="keys(ordenarPorQueries).length > 0" class="col-md-6">
        <span>Ordenar por: </span>
        <div class="btn-group" dropdown>
          <button class="btn btn-default" type="button" id="seletorOrdenarPor" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"  dropdownToggle>
            {{ ordenarPorQueries[ordenarPor] }}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="seletorOrdenarPor">
            <li *ngFor="let key of keys(ordenarPorQueries)" role="menuitem"><a (click)="ordenarPor = key; onRealizarBusca();" class="dropdown-item">{{ ordenarPorQueries[key] }}</a></li>
          </ul>
        </div>
        <button (click)="ordenarDesc = !ordenarDesc; onRealizarBusca();" type="button" class="btn btn-default" aria-label="Left Align">
          <span class="glyphicon glyphicon-sort-by-attributes" [ngClass]="{'glyphicon-sort-by-attributes': !ordenarDesc, 'glyphicon-sort-by-attributes-alt': ordenarDesc }" aria-hidden="true"></span>
        </button>
      </div>
    </div>
    <div class="row">

      <div class="col-sm-5 quantidade-respostas">
        <p>Exibindo itens: {{ obterStringDeQuantidadeNaResposta() }} de {{ totalDeItems }}. 
          <a (click)="baixarCSVDaConsulta()" class="btn btn-default">Baixar <span class="glyphicon glyphicon-download" ></span></a></p>
      </div>
  
      <div class="col-sm-3 itens-por-pagina" >
        <span>Itens por página: </span>
        <div class="btn-group" dropdown>
          <button class="btn btn-default" type="button" id="seletorNumeroDeItens" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"  dropdownToggle>
            {{ configurationService.limitResultados }}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="seletorOrdenarPor">
            <li *ngFor="let limit of opcoesDePaginacao" role="menuitem"><a (click)="configurationService.limitResultados = limit; onRealizarBusca();" class="dropdown-item">{{ limit }}</a></li>
          </ul>
        </div>
      </div>

      <div class="col-sm-4 paginacao-superior" *ngIf="(numeroDeItems < totalDeItems)">

        <pagination [totalItems]="totalDeItems" 
                    (pageChanged)="paginaAtual = $event.page; carregarPagina(paginaAtual);" 
                    [maxSize]=" maximoBotoes - 2" 
                    class="pagination-sm"
                    [boundaryLinks]="true" 
                    [rotate]="false"  
                    [(ngModel)]="paginaAtual"
                    nextText="&#x25B8;"
                    lastText="&#x25B8;&#x25B8;"
                    firstText="&#x25C2;&#x25C2;"
                    previousText="&#x25C2;"></pagination>
      </div>
    </div>
  </div>


  <div [@subirRespostas]='subirRespostasEstado' class="container-respostas">
    <div class="col-lg-8 col-md-12 col-lg-offset-2" [ngSwitch]="pesquisaPor" *ngIf="!buscaSemResultados && !carregandoDados">  

      <!-- GRADE OU LISTA DE RESULTADOS =================================================================================-->
      <div *ngSwitchCase="'projetos'" >
        <div *ngFor="let projeto of listaProjetos;" class="card col-md-6" >
          <div class="card-header texto-elipsado"><p>{{ projeto.nome }}</p></div>
            <div class="card-resposta texto-elipsado">
              <div class="row">
                <div class="col-sm-4"><p class="resposta-label">PRONAC: </p><p class="resposta-valor">{{ projeto.PRONAC }}</p></div>
                <div class="col-sm-4"><p class="resposta-label">Segmento: </p><p class="resposta-valor">{{ projeto.segmento }}</p></div>
                <div class="col-sm-4"><p class="resposta-label">Área: </p><p class="resposta-valor">{{ projeto.area }}</p></div>
              </div>
              <div class="row">
                <div class="col-sm-8"><p class="resposta-label">Proponente: </p><p class="resposta-valor">{{ projeto.proponente }}</p></div>
                <div class="col-sm-4"><p class="resposta-label">CPF/CNPJ: </p><p class="resposta-valor">{{ projeto.cgccpf }}</p></div>
              </div>
              <div class="row">
                <div class="col-sm-8"><p class="resposta-label">Data: </p><p class="resposta-valor">{{ dataFormatterService.formataData(projeto.data_inicio) }} - {{ dataFormatterService.formataData(projeto.data_inicio) }}</p></div>
                <div class="col-sm-4"><p class="resposta-label">Cidade: </p><p class="resposta-valor">{{ projeto.municipio }}, {{ projeto.UF }}</p></div>
              </div>
              <div class="row">
                <div class="col-sm-6"><p class="resposta-label">Valor Projeto: </p><p class="resposta-valor">{{ dataFormatterService.formataValorEmReais(projeto.valor_projeto) }}</p></div>
                <div class="col-sm-6"><p class="resposta-label">Valor Captado: </p><p class="resposta-valor">{{ dataFormatterService.formataValorEmReais(projeto.valor_captado) }}</p></div>
              </div>
              <div class="card-botoes">
                <button (click)="projeto.isResumoEscondido = !projeto.isResumoEscondido"
                          type="button" 
                          class="btn btn-default">Resumo <span class="glyphicon" [ngClass]="{'glyphicon-triangle-bottom': projeto.isResumoEscondido, 'glyphicon-triangle-top': !projeto.isResumoEscondido }" aria-hidden="true"></span></button>
                <button [routerLink]="['/projetos', projeto.PRONAC]" 
                        type="button" 
                        class="btn btn-primary">Ver Projeto</button>
              </div>

                
            </div>
            <div class="card-resumo" [ngStyle]="{'top': projeto.isResumoEscondido ? '45px' : '100%' }">
              <p>{{projeto.resumo}}</p>
            </div>
        </div>
      </div>

      <div *ngSwitchCase="'propostas'">
        <div *ngFor="let proposta of listaPropostas" class="card col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">{{ proposta.nome }}</div> 
            <div class="panel-body">
              <div class="col-sm-3"><button [routerLink]="['/propostas', proposta.id]" 
                                              type="button" 
                                              class="btn btn-primary" >Ver Proposta</button></div>
            </div>
          </div>
        </div>
      </div>
      <div *ngSwitchCase="'proponentes'">
        <div *ngFor="let proponente of listaProponentes" class="card col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">{{ proponente.nome }}</div> 
            <div class="panel-body">
              <div class="col-sm-9"><p>CGCCPF: </p><h4>{{ proponente.cgccpf }}</h4></div> 
              <div class="col-sm-3"><button [routerLink]="['/proponentes', dataFormatterService.extraiIdDaUrl(proponente._links.self)]" 
                                            type="button" 
                                            class="btn btn-primary" >Ver Proponente</button></div>
            </div>   
          </div>                                
        </div>
      </div>
      <div *ngSwitchCase="'incentivadores'">
        <div *ngFor="let incentivador of listaIncentivadores" class="card col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">{{ incentivador.nome }}</div> 
            <div class="panel-body">
              <div class="col-sm-9"><p>cgccpf: </p><h4>{{ incentivador.cgccpf }}</h4></div>
              <div class="col-sm-3"><button [routerLink]="['/incentivadores', dataFormatterService.extraiIdDaUrl(incentivador._links.self)]" 
                                            type="button" 
                                            class="btn btn-primary" >Ver Incentivador</button></div>
            </div>
          </div>
        </div>
      </div>
      <div *ngSwitchCase="'fornecedores'">
        <div *ngFor="let fornecedor of listaFornecedores" class="card col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">{{ fornecedor.nome }}</div> 
            <div class="panel-body">
              <div class="col-sm-9"><p>cgccpf: </p><h4>{{ fornecedor.cgccpf }}</h4></div>
            <div class="col-sm-3"><button [routerLink]="['/fornecedores', dataFormatterService.extraiIdDaUrl(fornecedor._links.self)]" 
                                            type="button" 
                                            class="btn btn-primary" >Ver Fornecedor</button></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <sk-fading-circle [isRunning]="carregandoDados"></sk-fading-circle>

  <alert *ngIf="buscaSemResultados" class="col-lg-8 col-md-12 col-lg-offset-2" type="danger">
    <p>Não encontramos {{ pesquisaPor }} com estes parâmetros de pesquisa :(</p>
    <p>Experimente mudar os termos de busca ou filtros aplicados.</p>
  </alert>
      
  <div class="text-center" *ngIf="(numeroDeItems < totalDeItems)">

    <pagination [totalItems]="totalDeItems" 
                (pageChanged)="paginaAtual = $event.page; carregarPagina(paginaAtual);" 
                [maxSize]=" maximoBotoes + 2" 
                class="pagination-sm"
                [boundaryLinks]="true" 
                [rotate]="false"  
                [(ngModel)]="paginaAtual"
                nextText="&#x25B8;"
                lastText="&#x25B8;&#x25B8;"
                firstText="&#x25C2;&#x25C2;"
                previousText="&#x25C2;"></pagination>
  </div>

</div>